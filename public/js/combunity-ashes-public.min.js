!function(a){a.fn.extend({leanModal:function(b){function c(b){a("#lean_overlay").fadeOut(200),a(b).css({display:"none"})}var d={top:100,overlay:.5,closeButton:null,cb:null},e=a("<div id='lean_overlay'></div>");return a("body").append(e),b=a.extend(d,b),this.each(function(){var d=b;a(this).click(function(e){var f=a(this).attr("href");a("#lean_overlay").click(function(){c(f)}),a(d.closeButton).click(function(){c(f)});var g=(a(f).outerHeight(),a(f).outerWidth()),g=60*a(window).width()/100;a("#lean_overlay").css({display:"block",opacity:0}),a("#lean_overlay").fadeTo(200,d.overlay),a(f).css({display:"block",position:"fixed",opacity:0,"z-index":11e3,left:"20%",top:d.top+"px",width:g+"px"}),a(f).fadeTo(200,1),b.cb&&b.cb(e),e.preventDefault()})})}})}(jQuery),function(a){"use strict";console.log("Main combunity client loaded");var b=function(a,b,c,d){jQuery.post(a,b,function(a){if(0==a)return void jQuery(d).find(".validation").text("Submission Failed").css("color","red");var b=jQuery.parseJSON(a);c(b)})};combunity.performAPIcall=b,combunity.editor={},combunity.editor.temp={},combunity.actions={};var c="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0nMTIwcHgnIGhlaWdodD0nMTIwcHgnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmlld0JveD0iMCAwIDEwMCAxMDAiIHByZXNlcnZlQXNwZWN0UmF0aW89InhNaWRZTWlkIiBjbGFzcz0idWlsLWJhbGxzIj48cmVjdCB4PSIwIiB5PSIwIiB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0ibm9uZSIgY2xhc3M9ImJrIj48L3JlY3Q+PGcgdHJhbnNmb3JtPSJyb3RhdGUoMCA1MCA1MCkiPgogIDxjaXJjbGUgcj0iNSIgY3g9IjMwIiBjeT0iNTAiPgogICAgPGFuaW1hdGVUcmFuc2Zvcm0gYXR0cmlidXRlTmFtZT0idHJhbnNmb3JtIiB0eXBlPSJ0cmFuc2xhdGUiIGJlZ2luPSIwcyIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiIGR1cj0iMXMiIHZhbHVlcz0iMCAwOzE5Ljk5OTk5OTk5OTk5OTk5NiAtMjAiIGtleVRpbWVzPSIwOzEiLz4KICAgIDxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9ImZpbGwiIGR1cj0iMXMiIGJlZ2luPSIwcyIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiICBrZXlUaW1lcz0iMDsxIiB2YWx1ZXM9IiNmZmY7Izk5OSIvPgogIDwvY2lyY2xlPgo8L2c+PGcgdHJhbnNmb3JtPSJyb3RhdGUoOTAgNTAgNTApIj4KICA8Y2lyY2xlIHI9IjUiIGN4PSIzMCIgY3k9IjUwIj4KICAgIDxhbmltYXRlVHJhbnNmb3JtIGF0dHJpYnV0ZU5hbWU9InRyYW5zZm9ybSIgdHlwZT0idHJhbnNsYXRlIiBiZWdpbj0iMHMiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIiBkdXI9IjFzIiB2YWx1ZXM9IjAgMDsxOS45OTk5OTk5OTk5OTk5OTYgLTIwIiBrZXlUaW1lcz0iMDsxIi8+CiAgICA8YW5pbWF0ZSBhdHRyaWJ1dGVOYW1lPSJmaWxsIiBkdXI9IjFzIiBiZWdpbj0iMHMiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIiAga2V5VGltZXM9IjA7MSIgdmFsdWVzPSIjOTk5OyMwMDAiLz4KICA8L2NpcmNsZT4KPC9nPjxnIHRyYW5zZm9ybT0icm90YXRlKDE4MCA1MCA1MCkiPgogIDxjaXJjbGUgcj0iNSIgY3g9IjMwIiBjeT0iNTAiPgogICAgPGFuaW1hdGVUcmFuc2Zvcm0gYXR0cmlidXRlTmFtZT0idHJhbnNmb3JtIiB0eXBlPSJ0cmFuc2xhdGUiIGJlZ2luPSIwcyIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiIGR1cj0iMXMiIHZhbHVlcz0iMCAwOzE5Ljk5OTk5OTk5OTk5OTk5NiAtMjAiIGtleVRpbWVzPSIwOzEiLz4KICAgIDxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9ImZpbGwiIGR1cj0iMXMiIGJlZ2luPSIwcyIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiICBrZXlUaW1lcz0iMDsxIiB2YWx1ZXM9IiMwMDA7I2ZmZiIvPgogIDwvY2lyY2xlPgo8L2c+PGcgdHJhbnNmb3JtPSJyb3RhdGUoMjcwIDUwIDUwKSI+CiAgPGNpcmNsZSByPSI1IiBjeD0iMzAiIGN5PSI1MCI+CiAgICA8YW5pbWF0ZVRyYW5zZm9ybSBhdHRyaWJ1dGVOYW1lPSJ0cmFuc2Zvcm0iIHR5cGU9InRyYW5zbGF0ZSIgYmVnaW49IjBzIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSIgZHVyPSIxcyIgdmFsdWVzPSIwIDA7MTkuOTk5OTk5OTk5OTk5OTk2IC0yMCIga2V5VGltZXM9IjA7MSIvPgogICAgPGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iZmlsbCIgZHVyPSIxcyIgYmVnaW49IjBzIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSIgIGtleVRpbWVzPSIwOzEiIHZhbHVlcz0iI2ZmZjsjOTk5Ii8+CiAgPC9jaXJjbGU+CjwvZz48L3N2Zz4=";combunity.loadersrc=c;var d='<svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52"><circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none"/><path class="checkmark__check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/></svg>',e={selector:".combunity-rte",menubar:!1,statusbar:!0,debug:!0,toolbar:"undo redo | bold italic strikethrough underline | emoticons  link image | blockquote | ",plugins:["advlist autolink link image advlist textcolor emoticons wordcount"],advlist_bullet_styles:"square",init_instance_callback:function(a){f.doSomething("Example"),a.on("keypress",function(b){var c=jQuery(a.editorContainer).position();if("@"==b.key){var d=a.windowManager.open({title:"Search user",url:"/?combunity_custom&editor=frontend&type=userpicker",width:50,height:100,top:0},{arg1:42,arg2:"Hello world"}),e=c.left,f=c.top;d.moveTo(e,f),b.preventDefault()}}),a.on("ExecCommand",function(a){console.log("ExecCommand")})},setup:function(a){a.on("init",function(a){console.debug(a.target.id);var b=tinymce.get(a.target.id).getParam("initiator");b&&(h(b.params.container),b.tempcontainer.show())})}};window.combunityeditor=function(){this.dispatcher=jQuery({})},window.combunityeditor.prototype={some_property:null,doSomething:function(a){this.some_property=a,this.dispatcher.trigger("somethingHappened")}};var f=new combunityeditor;f.dispatcher.on("somethingHappened",function(){combunity.iframeheightadjuster()}),combunity.tinymceconfig=e;var g=function(b){var d=a(b).contents();combunity.temporary=d;var e=jQuery("<div style='text-align:center'><img class='combunity-loader'  src='"+c+"'></img></div>");a(b).text(""),a(b).append(e)};combunity.showloading=g;var h=function(b){a(b).find(".combunity-loader").remove()};combunity.hideloading=h;var i=function(c){var e=this;this.params=c,this.btnsave=null,this.btncancel=null,this.validation=null,this.containercontents=null,this.formstruct=null,this.security=null,this.fetch=function(){e.containercontents=e.params.container.contents(),g(e.params.container);var a={};e.params.id&&(a.id=e.params.id),e.params.passdata&&(a.additional={cforum:e.params.passdata.cforum});var c={action:e.params.action,data:a},d=combunity.ajax_url;b(d,c,function(a){a.error?(e.validation=jQuery("<div></div>"),e.validation.attr("class","combunity-validation-error"),e.validation.text(a.info),h(e.params.container),e.params.container.append(e.validation)):e.params.isdelete?(console.log("Is delete section running "),h(e.params.container),e.validation=jQuery("<div></div>"),e.validation.html(a.info),h(e.params.container),e.params.container.append(e.validation)):(e.formstruct=a.info,e.security=a.security,e.build())})},this.build=function(){for(var b=jQuery("<div></div>"),c=0;c<e.formstruct.length;c++){var d=e.formstruct[c],f=null;switch(d.etype){case"select":var f=jQuery("<select></select>");f.attr("name",d.name),f.attr("value",d.value);for(var g=d.options.length-1;g>=0;g--){var h=d.options[g],i=jQuery("<option></option>");h.selected&&i.attr("selected",!0),i.text(h.name),i.attr("value",h.slug),f.append(i)}e.formstruct[c].element=f;break;case"text":var f=jQuery("<input>");f.attr("type","text"),f.attr("name",d.name),f.attr("value",d.value),e.formstruct[c].element=f;break;case"textarea":var f=jQuery("<textarea></textarea>");f.attr("name",d.name),f.text(d.value),e.formstruct[c].element=f,d.rte&&f.addClass("combunity-rte");break;case"hidden":var f=jQuery("<input>");f.attr("type","hidden"),f.attr("name",d.name),f.attr("value",d.value),e.formstruct[c].element=f;break;case"notice":var f=jQuery("<p></p>");f.attr("name",d.name),d.class&&f.attr("class",d.class),f.html(d.value),e.formstruct[c].element=f}if(e.params.labels&&"hidden"!=d.etype){var j=jQuery("<label></label>");d.label?j.text(d.label):j.text(d.name),b.append(j)}b.append(f)}e.validation=jQuery("<div></div>"),e.validation.attr("class","combunity-form-validation");var k="Save";e.params.savebtntext&&(k=e.params.savebtntext),e.btnsave=jQuery("<button>"+k+"</button>"),e.btnsave.attr("class","btn btn-primary combunity-ajax-save"),e.btncancel=jQuery("<button>Cancel</button>");var l="";e.params.nocancel&&(l=" hidden "),e.btncancel.attr("class","btn btn-info combunity-ajax-cancel"+l),e.btnsave.on("click",e.save),e.btncancel.on("click",e.cancel);var m=a("<div></div>");if(m.attr("class","combunity-ajax-btn-container"),m.append(e.btncancel),m.append(e.btnsave),b.append(m),b.append(e.validation),combunity.tinymceconfig.selector=".combunity-rte",console.log("Assigning intiator;"),combunity.tinymceconfig.initiator=e,e.tempcontainer=b,b.hide(),console.log(b),e.params.container.append(b),console.log("Initializing tinymce;"),0==jQuery(".combunity-rte").length){b.show(),console.log("Rich text editor not found!"),tinymce.remove(),delete combunity.tinymceconfig.selector;var n=a("<div>assaasas</div>");n.attr("class","tcms"),e.params.container.append(n),combunity.tinymceconfig.target=n[0],combunity.tinymceconfig.target=e.params.container.find(".tcms")[0],console.log(combunity.tinymceconfig.target),tinymce.init(combunity.tinymceconfig),console.log("Building tinymce ")}else tinymce.init(combunity.tinymceconfig)},this.init=function(){this.fetch()},this.cancel=function(){e.params.container.html(e.containercontents)},this.save=function(){e.containercontents=e.params.container.contents(),g(e.params.container);for(var c={},f=e.formstruct.length-1;f>=0;f--)e.formstruct[f].rte?c[e.formstruct[f].name]=tinyMCE.activeEditor.getContent():c[e.formstruct[f].name]=e.formstruct[f].element.val();var i={action:e.params.action_save,data:c,security:e.security};b(combunity.ajax_url,i,function(b){if(h(e.params.container),e.params.container.text(""),e.params.container.append(e.validation),b.error)e.validation.html(b.info);else{for(var c=e.formstruct.length-1;c>=0;c--)e.formstruct[c].element.remove();e.validation.html("");var f=a('<div style="text-align:center" >'+d+"</div>");e.validation.append(f);var g=b.info.validation;e.params.align||(e.params.align="left"),e.validation.append('<div style="text-align:'+e.params.align+'" >'+g+"</div>"),e.params.animatedtick||setInterval(function(){f.remove()},1200)}})},this.init()};a(function(){if(a("#comment").length>0&&"undefined"!=typeof tinymce){a("#commentform").attr("novalidate",""),combunity.tinymceconfig.selector="#comment";tinymce.init(combunity.tinymceconfig);a("#submit").on("click",function(b){a("#comment").val(tinyMCE.activeEditor.getContent())})}var c=function(){var a=null,b=[];return window.screen&&(b.pixelDepth=window.screen.pixelDepth,b.availWidth=window.screen.availWidth,b.availHeight=window.screen.availHeight,b.actWidth=window.screen.height,b.actHeight=window.screen.width,b.dppx=window.devicePixelRatio),b.actWidth<b.actHeight&&(a=b.actWidth),b.actHeight<b.actWidth&&(a=b.actHeight),a<=414};combunity.detectMobile=c,a("#submitpost").on("click",function(b){"undefined"==typeof tinymce&&a("#submitpost").attr("href","#loginmodal")}),a("#submitpost").on("click",function(a){}),combunity.detectMobile()||a("#submitpost").leanModal({top:100,closeButton:".modal_close",cb:function(){if(console.log("Clicked on submit post"),"undefined"!=typeof tinymce){var b=jQuery("#submitpostform .submissionform");new i({action:"combunity_get_forum_posts_form_meta",passdata:{cforum:a("#submitpost").data("forum")},action_save:"combunity_forum_posts_post",container:b,labels:!0,animatedtick:!0,align:"center",nocancel:!0,savebtntext:"Post"})}}}),combunity.renderpostform=function(){var a=jQuery(".submissionform");new i({action:"combunity_get_forum_posts_form_meta",passdata:{cforum:""},action_save:"combunity_forum_posts_post",container:a,labels:!0,animatedtick:!0,align:"center",nocancel:!0,savebtntext:"Post"})};var d=function(a,b){var c={action:"combunity_auth_login",data:a};combunity.performAPIcall(combunity.ajax_url,c,function(a){b(a)})},e=function(a,b){var c={action:"combunity_auth_signup",data:a};combunity.performAPIcall(combunity.ajax_url,c,function(a){b(a)})};if(jQuery(".combunity-login-form").on("submit",function(a){if(console.log("Submitting login form"),a.preventDefault(),"function"==typeof window.combunityThemeLoginHandler)return window.combunity.login=d,void window.combunityThemeLoginHandler(a,this);var b=jQuery(this).serializeArray(),c=this;jQuery(c).find(".combunity-validation-msg").text("Logging in..."),d(b,function(a){if(a.error){var b=jQuery.parseHTML(a.info);jQuery(c).find(".combunity-validation-msg").css("width",jQuery(c).width()),jQuery(c).find(".combunity-validation-msg").html(""),jQuery(b).appendTo(jQuery(c).find(".combunity-validation-msg"))}else combunity.nothememode?window.top.location.reload():location.reload()}),a.preventDefault()}),jQuery(".combunity-logout-link").on("click",function(a){}),jQuery(".combunity-signup-form").on("submit",function(a){var b=(jQuery("#combunity-signup-form"),jQuery(this).serializeArray()),c=this;console.log(b),jQuery(c).find(".combunity-validation-msg").text("Signing up..."),e(b,function(a){if(a.error){var b=jQuery.parseHTML(a.info);jQuery(".combunity-validation-msg").text(""),jQuery(b).appendTo(jQuery(c).find(".combunity-validation-msg"))}else combunity.nothememode?window.top.location.reload():location.reload()}),a.preventDefault()}),a(".newpost").on("click",function(){a("#submitpost").trigger("click")}),a(".comment-reply-link").on("click",function(a){combunity.tinymceconfig.selector="#comment",tinymce.remove(),setInterval(function(){tinymce.init(combunity.tinymceconfig)},100)}),a(".combunity-voting-bar-vote-comment").on("click",function(){var c=this,d=jQuery(this).parent().parent().data("postid"),e=jQuery(this).data("posttype"),f=(jQuery(this).parent(),this),g={id:d,vote_type:e},h={action:"combunity_post_comment_vote",data:g};a(this).css("position","relative"),a(this).css("z-index",1e3),a(this).animate({fontSize:"30px",left:"-14px",top:"-20px"},1e3);var i=a(this).css("font-size"),j=a(this).css("top");console.log(i),b(combunity.ajax_url,h,function(b){if(!b.error){var d="combunity-vote-"+e+"-highlight";a(f).addClass(d)}a(c).animate({fontSize:i,left:"0px",top:j},1e3)})}),a(".edit-comment").on("click",function(a){var b=this;console.log("Edit comment"),a.preventDefault();var c={};c.id=jQuery(this).data("id");var d=jQuery(b).closest(".combunity-comment-box").find(".comment-text");new i({action:"combunity_get_comment_form_meta",action_save:"combunity_post_comment",id:c.id,container:d,labels:!1})}),window.combunity.actions.editthread=function(a,b){var c=b;console.log("Edit thread"),a.preventDefault();var d={};d.id=jQuery(c).data("id");var e=jQuery(c).closest(".post-body").find(".post-container");new i({action:"combunity_get_edit_thread_form_meta",action_save:"combunity_post_thread",id:d.id,container:e,labels:!1})},a("body").on("click",".combunity-edit-thread-link",function(a){combunity.actions.editthread(a,this)}),a(".combunity-delete-thread-link").on("click",function(a){var b=this;console.log("Delete thread"),a.preventDefault();var c={};c.id=jQuery(this).data("id");var d=jQuery(b).closest(".post-body").find(".post-container"),e=confirm("Are you sure you want to delete this thread?");if(1==e){new i({action:"combunity_get_delete_thread",action_save:"combunity_post_thread",id:c.id,container:d,labels:!1,isdelete:!0})}}),a("#commentform").on("submit",function(a){if(!combunity.nothememode)return"0"==combunity.logged_in?(window.location=combunity.entrance_url,void a.preventDefault()):void 0}),jQuery(".submitthread").length>0){if(0==combunity.logged_in)return void jQuery(".submitthread").html(jQuery("#loginmodal").html());var f=jQuery(".submitthread");new i({action:"combunity_get_forum_posts_form_meta",action_save:"combunity_forum_posts_post",container:f,labels:!0,animatedtick:!0,align:"center",nocancel:!0,savebtntext:"Post"})}jQuery(".entrance").length>0&&jQuery(".entrance").html(jQuery("#loginmodal").html());var g=function(a,b){jQuery(a).hasClass("combunity-login-required")&&0==combunity.logged_in&&(alert(combunity.login_required_text),b.preventDefault())};combunity.iframeheightadjuster=function(){var a=jQuery(".combunity-iframe");setInterval(function(){a.css("height",a.contents().find("body").height())},2e3)},jQuery(document).ready(function(){var a=jQuery(".combunity-iframe");a.hide(),jQuery(".combunity-iframe").ready(function(){a.show(),jQuery(".combunity-loader-iframe").hide(),setTimeout(function(){a.css("height",a.contents().find("body").height()),setTimeout(function(){a.css("height",a.contents().find("body").height()),setTimeout(function(){a.css("height",a.contents().find("body").height())},500)},500)},500)})}),jQuery(".combunity-iframe").ready(function(){var a=jQuery(".combunity-iframe"),b=jQuery(".combunity-forums-plugin-stylesheet").text(),c=jQuery(".cforumphtml").html();a.contents().find("body").html(c),a.contents().find("body").append("<style type='text/css'>"+b+"</style>"),a.css("height",jQuery(".combunity-iframe").contents().find("body").height()),a.contents().find("body a").on("click",function(a){"true"!=jQuery(this).attr("noblank")?(window.location=jQuery(this).attr("href"),a.preventDefault()):g(this,a)})}),jQuery(".combunity-link").on("click",function(a){combunity.nothememode&&(window.top.location=jQuery(this).attr("href"),a.preventDefault())}),jQuery(".combunity-comment-form").on("submit",function(a){if("0"==combunity.logged_in)return alert(combunity.login_required_text),a.preventDefault(),!1}),jQuery(document).ready(function(){window.top.combunity.iframeheightadjuster()}),jQuery(document.body).on("click",".combunity-comment-extendible",function(){var a=this,b=jQuery(a).text(),c=jQuery(a).clone(),d=jQuery(a).data("cid"),e="",f=b.substring(0,3);if("[-]"==f){var g=jQuery(a).closest("li").find("ul.children li");console.log(g.length);var i=jQuery.trim(jQuery(a).parent().find(".author-name").text().toString()),k=i,l=1!=g.length?" nested comments":" nested comment";e="[+] "+k+" ( "+g.length+l+" )",jQuery(c).text(e);var m=jQuery(a).closest("li");console.log(m);var n=jQuery(m).prevAll().length,o=jQuery(m).closest("ul");h[d]=m.detach(),j[d]=n;var p=jQuery(document.createElement("li")),q=jQuery(c);q.appendTo(p),n-1<0?(n=0,jQuery(o).prepend(p)):(n--,jQuery(jQuery(o).children()).eq(n).after(p))}else{e="",jQuery(a).text(e),console.log("Expand tree");var o=jQuery(a).closest("ul"),n=j[d],r=h[d];n-1<0?(n=0,jQuery(o).prepend(r)):(n--,jQuery(jQuery(o).children()).eq(n).after(r)),jQuery(a).remove()}}),window.combunitypluginmodaltoggleform=!0;var h=[],j=[];window.combunity=combunity})}(jQuery);